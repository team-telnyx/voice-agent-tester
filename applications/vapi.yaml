html: |
  <!DOCTYPE html>
  <html>
  <head>
    <title>Vapi Voice Agent Test</title>
    <style>
      body { margin: 0; background: #f5f5f5; font-family: sans-serif; height: 100vh; }
    </style>
  </head>
  <body>
    <script>
      (function(d, t) {
        var g = document.createElement(t),
            s = d.getElementsByTagName(t)[0];
        g.src = "https://cdn.jsdelivr.net/gh/VapiAI/html-script-tag@latest/dist/assets/index.js";
        g.defer = true;
        g.async = true;
        s.parentNode.insertBefore(g, s);

        g.onload = function() {
          console.log('[VAPI] SDK loaded, vapiSDK available:', !!window.vapiSDK);
          var vapi = window.vapiSDK.run({
            apiKey: "{{providerApiKey}}",
            assistant: "{{assistantId}}",
            config: {
              position: "bottom-right",
              offset: "40px",
              width: "200px",
              height: "60px",
              idle: {
                type: "pill",
                title: "Talk to Vapi",
                subtitle: "Click to start",
                color: "rgb(93, 254, 202)",
                icon: "https://unpkg.com/lucide-static@0.321.0/icons/phone.svg"
              },
              loading: {
                type: "pill",
                title: "Connecting...",
                subtitle: "Please wait",
                color: "rgb(93, 124, 202)",
                icon: "https://unpkg.com/lucide-static@0.321.0/icons/loader-2.svg"
              },
              active: {
                type: "pill",
                title: "Call active",
                subtitle: "Click to end",
                color: "rgb(255, 0, 0)",
                icon: "https://unpkg.com/lucide-static@0.321.0/icons/phone-off.svg"
              }
            }
          });
          console.log('[VAPI] SDK run returned:', typeof vapi, vapi ? Object.keys(vapi).join(',') : 'null');

          // Log DOM after widget renders
          setTimeout(function() {
            var allButtons = document.querySelectorAll('button');
            console.log('[VAPI] Buttons in DOM:', allButtons.length);
            allButtons.forEach(function(btn, i) {
              console.log('[VAPI] Button ' + i + ':', btn.outerHTML.substring(0, 200));
            });
            // Also check for any clickable elements the widget might create
            var allDivs = document.querySelectorAll('div[role="button"], div[tabindex], div[onclick]');
            console.log('[VAPI] Clickable divs:', allDivs.length);
            // Check for shadow roots
            var allElements = document.querySelectorAll('*');
            allElements.forEach(function(el) {
              if (el.shadowRoot) {
                console.log('[VAPI] Shadow root found on:', el.tagName, el.id, el.className);
              }
            });
          }, 2000);
        };

        g.onerror = function(e) {
          console.error('[VAPI] Failed to load SDK:', e);
        };
      })(document, "script");
    </script>
  </body>
  </html>
tags:
  - provider
  - vapi
steps:
  - action: sleep
    time: 6000
  - action: click
    selector: "button"
  - action: sleep
    time: 3000
